<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">
    <title>JooyaCal Pro - Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ú©Ø§Ù„ÛŒØ¨Ø±Ø§Ø³ÛŒÙˆÙ† Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .developer-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.95em;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-top: 10px;
        }

        .developer-badge .dev-icon {
            font-size: 1.2em;
            margin-left: 5px;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 2px solid #dee2e6;
            color: #6c757d;
        }

        .footer-content {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .footer .copyright {
            font-size: 0.95em;
            font-weight: 500;
        }

        .footer .version {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-box {
            display: flex;
            flex-direction: column;
        }

        .input-box label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
        }

        .input-box input, .input-box textarea, .input-box select {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        .input-box textarea {
            min-height: 150px;
            resize: vertical;
        }

        .input-box input:focus, .input-box textarea:focus, .input-box select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .method-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .method-btn {
            padding: 15px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
        }

        .method-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .method-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.4);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        #chart-container {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        canvas {
            max-width: 100%;
            height: auto !important;
        }

        .results {
            margin-top: 20px;
            padding: 20px;
            background: #e7f3ff;
            border-radius: 10px;
            border-right: 5px solid #2196F3;
        }

        .results h3 {
            color: #2196F3;
            margin-bottom: 15px;
        }

        .result-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .predict-section {
            background: #fff3cd;
            border-right: 5px solid #ffc107;
        }

        .adjustment-section {
            background: #d1ecf1;
            border-right: 5px solid #17a2b8;
        }

        .batch-results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .batch-results-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        .batch-results-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }

        .batch-results-table tr:hover {
            background: #f8f9fa;
        }

        .batch-results-table tr:last-child td {
            border-bottom: none;
        }

        .help-text {
            font-size: 0.9em;
            color: #6c757d;
            font-style: italic;
            margin-top: 5px;
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
        }

        .install-prompt.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .input-group { grid-template-columns: 1fr; }
            .method-selector { grid-template-columns: 1fr; }
            .tab-container { flex-direction: column; }
        }

        .highlight-row {
            background: #d4edda !important;
            font-weight: bold;
        }

        .error-row {
            background: #f8d7da !important;
            color: #721c24;
        }

        .info-box {
            background: #d1ecf1;
            border: 2px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .info-box h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-right: 20px;
            color: #0c5460;
        }

        .calibrator-point {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .calibrator-point h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .adjusted-params {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .watermark {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            z-index: 999;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª JooyaCal Pro</h1>
            <p class="subtitle">Ø³ÛŒØ³ØªÙ… Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§Ø³ÛŒÙˆÙ† Ù…Ù†Ø­Ù†ÛŒ Ø¨Ø§ Cubic Spline Ùˆ Segmented Calibration</p>
            <div class="developer-badge">
                <span class="dev-icon">ğŸ‘¨â€âš•ï¸</span>
                <strong>Developed by Dr. Jooya</strong>
                <span class="dev-icon">âš¡</span>
            </div>
        </div>

        <div class="content">
            <!-- Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ -->
            <div class="section">
                <div class="section-title">ğŸ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ Ø¨Ø±Ø§Ø²Ø´</div>
                <div class="method-selector">
                    <button class="method-btn active" onclick="selectMethod('point')">
                        ğŸ“ Point-to-Point
                    </button>
                    <button class="method-btn" onclick="selectMethod('cubic')">
                        ğŸŒŠ Cubic Spline
                    </button>
                    <button class="method-btn" onclick="selectMethod('4pl')">
                        ğŸ“ˆ 4PL (Standard)
                    </button>
                    <button class="method-btn" onclick="selectMethod('5pl')">
                        ğŸ“Š 5PL (Standard)
                    </button>
                    <button class="method-btn" onclick="selectMethod('4pl-seg')">
                        ğŸ”§ 4PL (Segmented)
                    </button>
                    <button class="method-btn" onclick="selectMethod('5pl-seg')">
                        ğŸ”§ 5PL (Segmented)
                    </button>
                </div>

                <div id="method-info" class="info-box" style="display: none;"></div>
            </div>

            <!-- Ø¨Ø®Ø´ ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ -->
            <div class="section">
                <div class="section-title">ğŸ“ ÙˆØ±ÙˆØ¯ Ù†Ù‚Ø§Ø· Ú©Ø§Ù„ÛŒØ¨Ø±Ø§Ø³ÛŒÙˆÙ† Ø§ÙˆÙ„ÛŒÙ‡ (Ø­Ø¯Ø§Ù‚Ù„ 4 Ù†Ù‚Ø·Ù‡)</div>
                <div id="data-inputs"></div>
                <button class="btn btn-secondary" onclick="addDataPoint()">â• Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù‚Ø·Ù‡</button>
            </div>

            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="fitCurve()">ğŸš€ Ø¨Ø±Ø§Ø²Ø´ Ù…Ù†Ø­Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡</button>
                <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
            </div>

            <!-- Ù†Ù…ÙˆØ¯Ø§Ø± -->
            <div id="chart-container" style="display: none;">
                <canvas id="myChart"></canvas>
            </div>

            <!-- Ù†ØªØ§ÛŒØ¬ -->
            <div id="results" style="display: none;"></div>

            <!-- Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ… Ø¨Ø§ Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ± (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Segmented) -->
            <div class="section adjustment-section" id="adjustment-section" style="display: none;">
                <div class="section-title">ğŸ”§ ØªÙ†Ø¸ÛŒÙ… Ù…Ù†Ø­Ù†ÛŒ Ø¨Ø§ Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ±</div>
                
                <div class="info-box">
                    <h4>ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§:</h4>
                    <ul>
                        <li>Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ø§Ø² Ù…Ù†Ø­Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ (ÛŒÚ©ÛŒ Ù¾Ø§ÛŒÛŒÙ† Ùˆ ÛŒÚ©ÛŒ Ø¨Ø§Ù„Ø§)</li>
                        <li>Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙˆØ§Ù‚Ø¹ÛŒ (Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø´Ø¯Ù‡) Ø§ÛŒÙ† Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</li>
                        <li>Ù…Ù†Ø­Ù†ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÙ† Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ ØªÙ†Ø¸ÛŒÙ… (Adjust) Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
                    </ul>
                </div>

                <div class="calibrator-point">
                    <h4>ğŸ“ Ù†Ù‚Ø·Ù‡ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ± 1 (Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ±):</h4>
                    <div class="input-group">
                        <div class="input-box">
                            <label>ØºÙ„Ø¸Øª Ø´Ù†Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡:</label>
                            <input type="number" id="cal1-conc" step="any" placeholder="Ù…Ø«Ø§Ù„: 10">
                        </div>
                        <div class="input-box">
                            <label>Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø´Ø¯Ù‡:</label>
                            <input type="number" id="cal1-signal" step="any" placeholder="Ù…Ø«Ø§Ù„: 0.5">
                        </div>
                        <div class="input-box">
                            <label>Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø´Ø¯Ù‡ (Ø§Ø² Ù…Ù†Ø­Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡):</label>
                            <input type="number" id="cal1-predicted" disabled>
                        </div>
                    </div>
                    <button class="btn btn-info" onclick="calculatePredicted(1)">ğŸ” Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ</button>
                </div>

                <div class="calibrator-point">
                    <h4>ğŸ“ Ù†Ù‚Ø·Ù‡ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ± 2 (Ø¨Ø§Ù„Ø§ØªØ±):</h4>
                    <div class="input-group">
                        <div class="input-box">
                            <label>ØºÙ„Ø¸Øª Ø´Ù†Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡:</label>
                            <input type="number" id="cal2-conc" step="any" placeholder="Ù…Ø«Ø§Ù„: 100">
                        </div>
                        <div class="input-box">
                            <label>Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø´Ø¯Ù‡:</label>
                            <input type="number" id="cal2-signal" step="any" placeholder="Ù…Ø«Ø§Ù„: 2.0">
                        </div>
                        <div class="input-box">
                            <label>Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø´Ø¯Ù‡ (Ø§Ø² Ù…Ù†Ø­Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡):</label>
                            <input type="number" id="cal2-predicted" disabled>
                        </div>
                    </div>
                    <button class="btn btn-info" onclick="calculatePredicted(2)">ğŸ” Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ</button>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-warning" onclick="adjustCurve()">âš™ï¸ ØªÙ†Ø¸ÛŒÙ… Ù…Ù†Ø­Ù†ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¯Ùˆ Ù†Ù‚Ø·Ù‡</button>
                </div>

                <div id="adjusted-results" style="display: none;"></div>
            </div>

            <!-- Ø¨Ø®Ø´ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¨Ø§ Tab Ù‡Ø§ -->
            <div class="section predict-section" id="predict-section" style="display: none;">
                <div class="section-title">ğŸ”® Ù…Ø­Ø§Ø³Ø¨Ù‡ ØºÙ„Ø¸Øª Ø§Ø² Ø³ÛŒÚ¯Ù†Ø§Ù„</div>
                
                <!-- Tab Navigation -->
                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchTab('single')">
                        ğŸ”¢ Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªÚ©â€Œ Ù†Ù…ÙˆÙ†Ù‡
                    </button>
                    <button class="tab-btn" onclick="switchTab('batch')">
                        ğŸ“Š Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ (Ú†Ù†Ø¯ Ù†Ù…ÙˆÙ†Ù‡)
                    </button>
                </div>

                <!-- Tab 1: Single Prediction -->
                <div id="single-tab" class="tab-content active">
                    <div class="input-group">
                        <div class="input-box">
                            <label>Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯:</label>
                            <input type="number" id="new-signal" step="any" placeholder="Ù…Ø«Ø§Ù„: 0.5">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="predictSingle()">ğŸ’¡ Ù…Ø­Ø§Ø³Ø¨Ù‡ ØºÙ„Ø¸Øª</button>
                    <div id="predict-result"></div>
                </div>

                <!-- Tab 2: Batch Prediction -->
                <div id="batch-tab" class="tab-content">
                    <div class="input-box">
                        <label>Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ (Ù‡Ø± Ø®Ø· ÛŒÚ© Ù…Ù‚Ø¯Ø§Ø±):</label>
                        <textarea id="batch-signals" placeholder="Ù…Ø«Ø§Ù„:
0.1
0.25
0.5
0.75
1.0
1.5
2.0

ÛŒØ§ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ø´Ø¯Ù‡:
0.1, 0.25, 0.5, 0.75, 1.0

ÛŒØ§ Ø¨Ø§ ÙØ§ØµÙ„Ù‡:
0.1 0.25 0.5 0.75 1.0"></textarea>
                        <div class="help-text">ğŸ’¡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ø§ Ø¨Ø§ EnterØŒ Ú©Ø§Ù…Ø§ (,) ÛŒØ§ ÙØ§ØµÙ„Ù‡ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯</div>
                    </div>
                    <button class="btn btn-success" onclick="predictBatch()">ğŸš€ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ù…Ù‡ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§</button>
                    
                    <div id="batch-result"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-content">
                <span class="copyright">Â© 2025 <strong>Dr. Jooya</strong> - All Rights Reserved</span>
                <span class="version">v2.0 Pro</span>
            </div>
            <div style="margin-top: 10px; font-size: 0.9em;">
                ğŸ§¬ Advanced Calibration Curve Software | 
                ğŸ“§ Contact: <strong>dr.jooya@example.com</strong>
            </div>
        </div>
    </div>

    <!-- Watermark -->
    <div class="watermark">
        âš¡ JooyaCal by Dr. Jooya
    </div>

    <!-- Ù¾ÛŒØ§Ù… Ù†ØµØ¨ PWA -->
    <div class="install-prompt" id="install-prompt">
        <h3>ğŸ“± Ù†ØµØ¨ Ø¨Ø±Ù†Ø§Ù…Ù‡</h3>
        <p>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ø±ÙˆÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ ÛŒØ§ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø®ÙˆØ¯ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯</p>
        <button class="btn btn-primary" onclick="installApp()">Ù†ØµØ¨</button>
        <button class="btn btn-secondary" onclick="dismissInstall()">Ø¨Ø¹Ø¯Ø§Ù‹</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let currentMethod = 'point';
        let dataPoints = [];
        let chart = null;
        let fittedParams = null;
        let adjustedParams = null;
        let splineCoefficients = null;
        let deferredPrompt;
        let isAdjusted = false;

        // ØªÙˆØ¶ÛŒØ­Ø§Øª Ø±ÙˆØ´â€ŒÙ‡Ø§
        const methodDescriptions = {
            'point': {
                title: 'ğŸ“ Point-to-Point (Ø¯Ø±ÙˆÙ†â€ŒÛŒØ§Ø¨ÛŒ Ø®Ø·ÛŒ)',
                desc: 'Ø§ØªØµØ§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ… Ù†Ù‚Ø§Ø· Ø¨Ø§ Ø®Ø·ÙˆØ· Ù…Ø³ØªÙ‚ÛŒÙ… - Ø³Ø§Ø¯Ù‡ Ùˆ Ø³Ø±ÛŒØ¹'
            },
            'cubic': {
                title: 'ğŸŒŠ Cubic Spline',
                desc: 'Ù…Ù†Ø­Ù†ÛŒ Ù‡Ù…ÙˆØ§Ø± Ùˆ Ù¾ÛŒÙˆØ³ØªÙ‡ Ø¨Ø§ Ú†Ù†Ø¯Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø¬Ù‡ 3 - Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±ÛŒÙ† Ø±ÙˆØ´ Ø¯Ø±ÙˆÙ†â€ŒÛŒØ§Ø¨ÛŒ'
            },
            '4pl': {
                title: 'ğŸ“ˆ 4-Parameter Logistic (Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯)',
                desc: 'Ù…Ø¯Ù„ Ø³ÛŒÚ¯Ù…ÙˆØ¦ÛŒØ¯ÛŒ Ø¨Ø§ 4 Ù¾Ø§Ø±Ø§Ù…ØªØ± - Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ø§Ú©Ø«Ø± ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ…ÙˆÙ†ÙˆØ§Ø³ÛŒ'
            },
            '5pl': {
                title: 'ğŸ“Š 5-Parameter Logistic (Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯)',
                desc: 'Ù…Ø¯Ù„ Ø³ÛŒÚ¯Ù…ÙˆØ¦ÛŒØ¯ÛŒ Ù†Ø§Ù…ØªÙ‚Ø§Ø±Ù† Ø¨Ø§ 5 Ù¾Ø§Ø±Ø§Ù…ØªØ± - Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø±Ø§ÛŒ Ù…Ù†Ø­Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡'
            },
            '4pl-seg': {
                title: 'ğŸ”§ 4PL Segmented (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…)',
                desc: 'Ù…Ø¯Ù„ 4PL Ú©Ù‡ Ø¨Ø§ Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ± Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… Ø§Ø³Øª - Ø¨Ø±Ø§ÛŒ Ø±ÙˆØªÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡'
            },
            '5pl-seg': {
                title: 'ğŸ”§ 5PL Segmented (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…)',
                desc: 'Ù…Ø¯Ù„ 5PL Ú©Ù‡ Ø¨Ø§ Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ± Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ… Ø§Ø³Øª - Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§ + Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ'
            }
        };

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt').classList.add('show');
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                    dismissInstall();
                });
            }
        }

        function dismissInstall() {
            document.getElementById('install-prompt').classList.remove('show');
        }

        // Switch between tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´
        function selectMethod(method) {
            currentMethod = method;
            document.querySelectorAll('.method-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Ù†Ù…Ø§ÛŒØ´ ØªÙˆØ¶ÛŒØ­Ø§Øª
            const info = methodDescriptions[method];
            const infoBox = document.getElementById('method-info');
            infoBox.innerHTML = `<h4>${info.title}</h4><p>${info.desc}</p>`;
            infoBox.style.display = 'block';

            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ adjustment Ø§Ú¯Ø± Ø±ÙˆØ´ segmented Ù†ÛŒØ³Øª
            if (method.includes('-seg')) {
                // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ adjustment Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ Ù…Ù†Ø­Ù†ÛŒ
                if (fittedParams) {
                    document.getElementById('adjustment-section').style.display = 'block';
                }
            } else {
                document.getElementById('adjustment-section').style.display = 'none';
            }
        }

        // Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù‚Ø·Ù‡ Ø¯Ø§Ø¯Ù‡
        function addDataPoint() {
            const container = document.getElementById('data-inputs');
            const index = container.children.length;
            
            const inputGroup = document.createElement('div');
            inputGroup.className = 'input-group';
            inputGroup.innerHTML = `
                <div class="input-box">
                    <label>ØºÙ„Ø¸Øª ${index + 1}:</label>
                    <input type="number" class="conc-input" step="any" placeholder="Ù…Ø«Ø§Ù„: 10">
                </div>
                <div class="input-box">
                    <label>Ø³ÛŒÚ¯Ù†Ø§Ù„ ${index + 1}:</label>
                    <input type="number" class="signal-input" step="any" placeholder="Ù…Ø«Ø§Ù„: 0.5">
                </div>
            `;
            container.appendChild(inputGroup);
        }

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ - ØªØºÛŒÛŒØ± Ø§Ø² 6 Ø¨Ù‡ 4
        for (let i = 0; i < 4; i++) {
            addDataPoint();
        }

        // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ - ØªØºÛŒÛŒØ± Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø² 6 Ø¨Ù‡ 4
        function collectData() {
            const concInputs = document.querySelectorAll('.conc-input');
            const signalInputs = document.querySelectorAll('.signal-input');
            
            dataPoints = [];
            for (let i = 0; i < concInputs.length; i++) {
                const conc = parseFloat(concInputs[i].value);
                const signal = parseFloat(signalInputs[i].value);
                
                if (!isNaN(conc) && !isNaN(signal)) {
                    dataPoints.push({ x: conc, y: signal });
                }
            }
            
            dataPoints.sort((a, b) => a.x - b.x);
            return dataPoints.length >= 4;
        }

        // ========== ØªÙˆØ§Ø¨Ø¹ Ø±ÛŒØ§Ø¶ÛŒ ==========

        // ØªÙˆØ§Ø¨Ø¹ 4PL Ùˆ 5PL
        function pl4(x, a, b, c, d) {
            return d + (a - d) / (1 + Math.pow(x / c, b));
        }

        function pl5(x, a, b, c, d, g) {
            return d + (a - d) / Math.pow(1 + Math.pow(x / c, b), g);
        }

        // ========== Cubic Spline Implementation ==========
        
        function computeCubicSpline(xData, yData) {
            const n = xData.length - 1;
            const h = [];
            const alpha = [];
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ h
            for (let i = 0; i < n; i++) {
                h[i] = xData[i + 1] - xData[i];
            }
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ alpha
            for (let i = 1; i < n; i++) {
                alpha[i] = (3 / h[i]) * (yData[i + 1] - yData[i]) - 
                           (3 / h[i - 1]) * (yData[i] - yData[i - 1]);
            }
            
            // Ø­Ù„ Ø³ÛŒØ³ØªÙ… Ø³Ù‡ Ù‚Ø·Ø±ÛŒ Ø¨Ø±Ø§ÛŒ c
            const l = [1];
            const mu = [0];
            const z = [0];
            
            for (let i = 1; i < n; i++) {
                l[i] = 2 * (xData[i + 1] - xData[i - 1]) - h[i - 1] * mu[i - 1];
                mu[i] = h[i] / l[i];
                z[i] = (alpha[i] - h[i - 1] * z[i - 1]) / l[i];
            }
            
            const c = new Array(n + 1).fill(0);
            const b = new Array(n);
            const d = new Array(n);
            
            l[n] = 1;
            z[n] = 0;
            c[n] = 0;
            
            for (let j = n - 1; j >= 0; j--) {
                c[j] = z[j] - mu[j] * c[j + 1];
                b[j] = (yData[j + 1] - yData[j]) / h[j] - h[j] * (c[j + 1] + 2 * c[j]) / 3;
                d[j] = (c[j + 1] - c[j]) / (3 * h[j]);
            }
            
            return {
                x: xData,
                a: yData,
                b: b,
                c: c,
                d: d
            };
        }
        
        function evaluateSpline(x, spline) {
            const n = spline.x.length - 1;
            
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²Ù‡ Ù…Ù†Ø§Ø³Ø¨
            let i = 0;
            if (x < spline.x[0]) {
                // Ø¨Ø±ÙˆÙ†â€ŒÛŒØ§Ø¨ÛŒ Ø®Ø·ÛŒ Ø¯Ø± Ø³Ù…Øª Ú†Ù¾
                const slope = spline.b[0];
                return spline.a[0] + slope * (x - spline.x[0]);
            }
            if (x > spline.x[n]) {
                // Ø¨Ø±ÙˆÙ†â€ŒÛŒØ§Ø¨ÛŒ Ø®Ø·ÛŒ Ø¯Ø± Ø³Ù…Øª Ø±Ø§Ø³Øª
                const slope = spline.b[n - 1] + 2 * spline.c[n - 1] * (spline.x[n] - spline.x[n - 1]) + 
                              3 * spline.d[n - 1] * Math.pow(spline.x[n] - spline.x[n - 1], 2);
                return spline.a[n] + slope * (x - spline.x[n]);
            }
            
            for (i = 0; i < n; i++) {
                if (x >= spline.x[i] && x <= spline.x[i + 1]) {
                    break;
                }
            }
            
            const dx = x - spline.x[i];
            return spline.a[i] + spline.b[i] * dx + spline.c[i] * dx * dx + spline.d[i] * dx * dx * dx;
        }

        // Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Levenberg-Marquardt
        function fitCurveLM(xData, yData, func, initialParams) {
            let params = [...initialParams];
            const maxIter = 1000;
            const tolerance = 1e-8;
            let lambda = 0.01;

            for (let iter = 0; iter < maxIter; iter++) {
                const residuals = xData.map((x, i) => yData[i] - func(x, ...params));
                const rss = residuals.reduce((sum, r) => sum + r * r, 0);

                const jacobian = computeJacobian(xData, params, func);
                const JtJ = multiplyMatrices(transpose(jacobian), jacobian);
                const Jtr = multiplyMatrixVector(transpose(jacobian), residuals);

                for (let i = 0; i < JtJ.length; i++) {
                    JtJ[i][i] *= (1 + lambda);
                }

                const delta = solveLinearSystem(JtJ, Jtr);
                const newParams = params.map((p, i) => p + delta[i]);

                const newResiduals = xData.map((x, i) => yData[i] - func(x, ...newParams));
                const newRss = newResiduals.reduce((sum, r) => sum + r * r, 0);

                if (newRss < rss) {
                    params = newParams;
                    lambda /= 10;
                    if (Math.abs(rss - newRss) < tolerance) break;
                } else {
                    lambda *= 10;
                }
            }

            return params;
        }

        function computeJacobian(xData, params, func) {
            const eps = 1e-8;
            const jacobian = [];

            for (let i = 0; i < xData.length; i++) {
                const row = [];
                for (let j = 0; j < params.length; j++) {
                    const p1 = [...params];
                    const p2 = [...params];
                    p1[j] -= eps;
                    p2[j] += eps;
                    const derivative = (func(xData[i], ...p2) - func(xData[i], ...p1)) / (2 * eps);
                    row.push(derivative);
                }
                jacobian.push(row);
            }

            return jacobian;
        }

        function transpose(matrix) {
            return matrix[0].map((_, i) => matrix.map(row => row[i]));
        }

        function multiplyMatrices(a, b) {
            const result = [];
            for (let i = 0; i < a.length; i++) {
                result[i] = [];
                for (let j = 0; j < b[0].length; j++) {
                    let sum = 0;
                    for (let k = 0; k < a[0].length; k++) {
                        sum += a[i][k] * b[k][j];
                    }
                    result[i][j] = sum;
                }
            }
            return result;
        }

        function multiplyMatrixVector(matrix, vector) {
            return matrix.map(row => 
                row.reduce((sum, val, i) => sum + val * vector[i], 0)
            );
        }

        function solveLinearSystem(A, b) {
            const n = A.length;
            const augmented = A.map((row, i) => [...row, b[i]]);

            for (let i = 0; i < n; i++) {
                let maxRow = i;
                for (let k = i + 1; k < n; k++) {
                    if (Math.abs(augmented[k][i]) > Math.abs(augmented[maxRow][i])) {
                        maxRow = k;
                    }
                }
                [augmented[i], augmented[maxRow]] = [augmented[maxRow], augmented[i]];

                for (let k = i + 1; k < n; k++) {
                    const factor = augmented[k][i] / augmented[i][i];
                    for (let j = i; j <= n; j++) {
                        augmented[k][j] -= factor * augmented[i][j];
                    }
                }
            }

            const x = new Array(n);
            for (let i = n - 1; i >= 0; i--) {
                x[i] = augmented[i][n];
                for (let j = i + 1; j < n; j++) {
                    x[i] -= augmented[i][j] * x[j];
                }
                x[i] /= augmented[i][i];
            }

            return x;
        }

        // ========== Ø¨Ø±Ø§Ø²Ø´ Ù…Ù†Ø­Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ==========
        
        function fitCurve() {
            if (!collectData()) {
                alert('âš ï¸ Ø­Ø¯Ø§Ù‚Ù„ 4 Ù†Ù‚Ø·Ù‡ Ø¯Ø§Ø¯Ù‡ Ù„Ø§Ø²Ù… Ø§Ø³Øª!');
                return;
            }

            const xData = dataPoints.map(p => p.x);
            const yData = dataPoints.map(p => p.y);

            let curveData = [];
            let resultsHTML = '<div class="results"><h3>ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§Ø²Ø´ Ù…Ù†Ø­Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡</h3>';

            isAdjusted = false;
            adjustedParams = null;

            if (currentMethod === 'point') {
                const minX = Math.min(...xData);
                const maxX = Math.max(...xData);
                
                for (let x = minX; x <= maxX; x += (maxX - minX) / 100) {
                    let y = 0;
                    for (let i = 0; i < xData.length - 1; i++) {
                        if (x >= xData[i] && x <= xData[i + 1]) {
                            const t = (x - xData[i]) / (xData[i + 1] - xData[i]);
                            y = yData[i] + t * (yData[i + 1] - yData[i]);
                            break;
                        }
                    }
                    curveData.push({ x, y });
                }

                resultsHTML += '<div class="result-item">âœ… Ø±ÙˆØ´: Ø¯Ø±ÙˆÙ†â€ŒÛŒØ§Ø¨ÛŒ Ø®Ø·ÛŒ Point-to-Point</div>';

            } else if (currentMethod === 'cubic') {
                splineCoefficients = computeCubicSpline(xData, yData);
                
                const minX = Math.min(...xData);
                const maxX = Math.max(...xData);
                
                for (let x = minX; x <= maxX; x += (maxX - minX) / 200) {
                    const y = evaluateSpline(x, splineCoefficients);
                    curveData.push({ x, y });
                }

                resultsHTML += '<div class="result-item">âœ… Ø±ÙˆØ´: Cubic Spline (Ú†Ù†Ø¯Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø¯Ø±Ø¬Ù‡ 3)</div>';
                resultsHTML += `<div class="result-item">ğŸ“ˆ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ spline: ${xData.length - 1}</div>`;

            } else if (currentMethod === '4pl' || currentMethod === '4pl-seg') {
                const minY = Math.min(...yData);
                const maxY = Math.max(...yData);
                const midX = xData[Math.floor(xData.length / 2)];
                
                const initialParams = [maxY, 1, midX, minY];
                fittedParams = fitCurveLM(xData, yData, pl4, initialParams);

                const minX = Math.min(...xData) * 0.5;
                const maxX = Math.max(...xData) * 1.5;

                for (let x = minX; x <= maxX; x += (maxX - minX) / 200) {
                    const y = pl4(x, ...fittedParams);
                    curveData.push({ x, y });
                }

                const mode = currentMethod === '4pl-seg' ? 'Segmented (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…)' : 'Standard';
                resultsHTML += `<div class="result-item">âœ… Ø±ÙˆØ´: 4-Parameter Logistic (4PL) - ${mode}</div>`;
                resultsHTML += `<div class="result-item">ğŸ“ˆ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡:</div>`;
                resultsHTML += `<div class="result-item">â€¢ A (Ø­Ø¯Ø§Ú©Ø«Ø±) = ${fittedParams[0].toFixed(6)}</div>`;
                resultsHTML += `<div class="result-item">â€¢ B (Ø´ÛŒØ¨) = ${fittedParams[1].toFixed(6)}</div>`;
                resultsHTML += `<div class="result-item">â€¢ C (Ù†Ù‚Ø·Ù‡ Ø¹Ø·Ù) = ${fittedParams[2].toFixed(6)}</div>`;
                resultsHTML += `<div class="result-item">â€¢ D (Ø­Ø¯Ø§Ù‚Ù„) = ${fittedParams[3].toFixed(6)}</div>`;
                
                resultsHTML += `<div class="result-item">ğŸ“ Ù…Ø¹Ø§Ø¯Ù„Ù‡: $Y = D + \\frac{A - D}{1 + (\\frac{X}{C})^B}$</div>`;

            } else if (currentMethod === '5pl' || currentMethod === '5pl-seg') {
                const minY = Math.min(...yData);
                const maxY = Math.max(...yData);
                const midX = xData[Math.floor(xData.length / 2)];
                
                const initialParams = [maxY, 1, midX, minY, 1];
                fittedParams = fitCurveLM(xData, yData, pl5, initialParams);

                const minX = Math.min(...xData) * 0.5;
                const maxX = Math.max(...xData) * 1.5;

                for (let x = minX; x <= maxX; x += (maxX - minX) / 200) {
                    const y = pl5(x, ...fittedParams);
                    curveData.push({ x, y });
                }

                const mode = currentMethod === '5pl-seg' ? 'Segmented (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…)' : 'Standard';
                resultsHTML += `<div class="result-item">âœ… Ø±ÙˆØ´: 5-Parameter Logistic (5PL) - ${mode}</div>`;
                resultsHTML += `<div class="result-item">ğŸ“ˆ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡:</div>`;
                resultsHTML += `<div class="result-item">â€¢ A (Ø­Ø¯Ø§Ú©Ø«Ø±) = ${fittedParams[0].toFixed(6)}</div>`;
                resultsHTML += `<div class="result-item">â€¢ B (Ø´ÛŒØ¨) = ${fittedParams[1].toFixed(6)}</div>`;
                resultsHTML += `<div class="result-item">â€¢ C (Ù†Ù‚Ø·Ù‡ Ø¹Ø·Ù) = ${fittedParams[2].toFixed(6)}</div>`;
                resultsHTML += `<div class="result-item">â€¢ D (Ø­Ø¯Ø§Ù‚Ù„) = ${fittedParams[3].toFixed(6)}</div>`;
                resultsHTML += `<div class="result-item">â€¢ G (Ù†Ø§Ù…ØªÙ‚Ø§Ø±Ù†ÛŒ) = ${fittedParams[4].toFixed(6)}</div>`;
                
                resultsHTML += `<div class="result-item">ğŸ“ Ù…Ø¹Ø§Ø¯Ù„Ù‡: $Y = D + \\frac{A - D}{(1 + (\\frac{X}{C})^B)^G}$</div>`;
            }

            resultsHTML += '</div>';

            drawChart(curveData);

            document.getElementById('results').innerHTML = resultsHTML;
            document.getElementById('results').style.display = 'block';
            document.getElementById('predict-section').style.display = 'block';

            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ adjustment Ø¨Ø±Ø§ÛŒ Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ segmented
            if (currentMethod.includes('-seg')) {
                document.getElementById('adjustment-section').style.display = 'block';
            }

            // Ø±Ù†Ø¯Ø± MathJax Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }

        // ========== Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù‚Ø§Ø· Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ± ==========
        
        function calculatePredicted(pointNum) {
            const conc = parseFloat(document.getElementById(`cal${pointNum}-conc`).value);
            
            if (isNaN(conc)) {
                alert('âš ï¸ Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ØºÙ„Ø¸Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            if (!fittedParams && !splineCoefficients) {
                alert('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ù…Ù†Ø­Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§ Ø¨Ø±Ø§Ø²Ø´ Ø¯Ù‡ÛŒØ¯!');
                return;
            }

            let predictedSignal;

            if (currentMethod === '4pl-seg') {
                predictedSignal = pl4(conc, ...fittedParams);
            } else if (currentMethod === '5pl-seg') {
                predictedSignal = pl5(conc, ...fittedParams);
            }

            document.getElementById(`cal${pointNum}-predicted`).value = predictedSignal.toFixed(6);
        }

        // ========== ØªÙ†Ø¸ÛŒÙ… Ù…Ù†Ø­Ù†ÛŒ Ø¨Ø§ Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ± ==========
        
        function adjustCurve() {
            const cal1Conc = parseFloat(document.getElementById('cal1-conc').value);
            const cal1Signal = parseFloat(document.getElementById('cal1-signal').value);
            const cal1Predicted = parseFloat(document.getElementById('cal1-predicted').value);
            
            const cal2Conc = parseFloat(document.getElementById('cal2-conc').value);
            const cal2Signal = parseFloat(document.getElementById('cal2-signal').value);
            const cal2Predicted = parseFloat(document.getElementById('cal2-predicted').value);

            if (isNaN(cal1Conc) || isNaN(cal1Signal) || isNaN(cal2Conc) || isNaN(cal2Signal)) {
                alert('âš ï¸ Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            if (isNaN(cal1Predicted) || isNaN(cal2Predicted)) {
                alert('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø´Ø¯Ù‡ Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†ÛŒØ¯!');
                return;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Shift Ùˆ Scale
            // Signal_measured = Scale * Signal_predicted + Shift
            
            const shift = ((cal1Signal * cal2Predicted) - (cal2Signal * cal1Predicted)) / (cal2Predicted - cal1Predicted);
            const scale = (cal2Signal - cal1Signal) / (cal2Predicted - cal1Predicted);

            // ØªÙ†Ø¸ÛŒÙ… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§
            if (currentMethod === '4pl-seg') {
                // Ø¨Ø±Ø§ÛŒ 4PL: Signal = D + (A-D) / (1 + (X/C)^B)
                // Signal_new = Scale * Signal_old + Shift
                // D_new = Scale * D + Shift
                // A_new = Scale * A + Shift
                
                adjustedParams = [
                    fittedParams[0] * scale + shift,  // A
                    fittedParams[1],                  // B (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
                    fittedParams[2],                  // C (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
                    fittedParams[3] * scale + shift   // D
                ];

            } else if (currentMethod === '5pl-seg') {
                adjustedParams = [
                    fittedParams[0] * scale + shift,  // A
                    fittedParams[1],                  // B (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
                    fittedParams[2],                  // C (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
                    fittedParams[3] * scale + shift,  // D
                    fittedParams[4]                   // G (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
                ];
            }

            isAdjusted = true;

            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ ØªÙ†Ø¸ÛŒÙ…
            let html = '<div class="adjusted-params">';
            html += '<h3>âœ… Ù…Ù†Ø­Ù†ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯</h3>';
            html += `<div class="result-item"><strong>ğŸ“Š Ø¶Ø±Ø§ÛŒØ¨ ØªÙ†Ø¸ÛŒÙ…:</strong></div>`;
            html += `<div class="result-item">â€¢ Scale Factor: ${scale.toFixed(6)}</div>`;
            html += `<div class="result-item">â€¢ Shift: ${shift.toFixed(6)}</div>`;
            html += `<div class="result-item">â€¢ Ù…Ø¹Ø§Ø¯Ù„Ù‡: Signal_new = ${scale.toFixed(4)} Ã— Signal_old + ${shift.toFixed(4)}</div>`;
            html += '<br>';
            html += `<div class="result-item"><strong>ğŸ“ˆ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡:</strong></div>`;
            html += `<div class="result-item">â€¢ A (Ø­Ø¯Ø§Ú©Ø«Ø±) = ${adjustedParams[0].toFixed(6)}</div>`;
            html += `<div class="result-item">â€¢ B (Ø´ÛŒØ¨) = ${adjustedParams[1].toFixed(6)}</div>`;
            html += `<div class="result-item">â€¢ C (Ù†Ù‚Ø·Ù‡ Ø¹Ø·Ù) = ${adjustedParams[2].toFixed(6)}</div>`;
            html += `<div class="result-item">â€¢ D (Ø­Ø¯Ø§Ù‚Ù„) = ${adjustedParams[3].toFixed(6)}</div>`;
            
            if (currentMethod === '5pl-seg') {
                html += `<div class="result-item">â€¢ G (Ù†Ø§Ù…ØªÙ‚Ø§Ø±Ù†ÛŒ) = ${adjustedParams[4].toFixed(6)}</div>`;
            }
            
            html += '</div>';

            document.getElementById('adjusted-results').innerHTML = html;
            document.getElementById('adjusted-results').style.display = 'block';

            // ØªØ±Ø³ÛŒÙ… Ù…Ø¬Ø¯Ø¯ Ù†Ù…ÙˆØ¯Ø§Ø± Ø¨Ø§ Ù…Ù†Ø­Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡
            redrawWithAdjustedCurve();
        }

        function redrawWithAdjustedCurve() {
            const xData = dataPoints.map(p => p.x);
            const minX = Math.min(...xData) * 0.5;
            const maxX = Math.max(...xData) * 1.5;

            const adjustedCurveData = [];
            
            for (let x = minX; x <= maxX; x += (maxX - minX) / 200) {
                let y;
                if (currentMethod === '4pl-seg') {
                    y = pl4(x, ...adjustedParams);
                } else if (currentMethod === '5pl-seg') {
                    y = pl5(x, ...adjustedParams);
                }
                adjustedCurveData.push({ x, y });
            }

            // Ù†Ù…ÙˆØ¯Ø§Ø± Ø¨Ø§ Ø¯Ùˆ Ù…Ù†Ø­Ù†ÛŒ
            const ctx = document.getElementById('myChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Ù†Ù‚Ø§Ø· Ú©Ø§Ù„ÛŒØ¨Ø±Ø§Ø³ÛŒÙˆÙ† Ø§ÙˆÙ„ÛŒÙ‡',
                            data: dataPoints,
                            backgroundColor: 'rgba(255, 99, 132, 0.8)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            pointRadius: 8,
                            pointHoverRadius: 10
                        },
                        {
                            label: 'Ù…Ù†Ø­Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡',
                            data: getCurrentCurveData(),
                            borderColor: 'rgba(54, 162, 235, 0.5)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            showLine: true,
                            pointRadius: 0,
                            borderWidth: 2,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Ù…Ù†Ø­Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ (Adjusted)',
                            data: adjustedCurveData,
                            borderColor: 'rgba(40, 167, 69, 1)',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            showLine: true,
                            pointRadius: 0,
                            borderWidth: 3
                        },
                        {
                            label: 'Ù†Ù‚Ø§Ø· Ú©Ø§Ù„ÛŒØ¨Ø±Ø§ØªÙˆØ±',
                            data: [
                                { 
                                    x: parseFloat(document.getElementById('cal1-conc').value), 
                                    y: parseFloat(document.getElementById('cal1-signal').value) 
                                },
                                { 
                                    x: parseFloat(document.getElementById('cal2-conc').value), 
                                    y: parseFloat(document.getElementById('cal2-signal').value) 
                                }
                            ],
                            backgroundColor: 'rgba(255, 193, 7, 1)',
                            borderColor: 'rgba(255, 193, 7, 1)',
                            pointRadius: 12,
                            pointStyle: 'star',
                            pointHoverRadius: 15
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    plugins: {
                        title: {
                            display: true,
                            text: 'JooyaCal Pro - Ù…Ù†Ø­Ù†ÛŒ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§Ø³ÛŒÙˆÙ† (Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡)',
                            font: { size: 18 }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ØºÙ„Ø¸Øª (Concentration)',
                                font: { size: 14 }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Ø³ÛŒÚ¯Ù†Ø§Ù„ (Signal)',
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }

        function getCurrentCurveData() {
            const xData = dataPoints.map(p => p.x);
            const minX = Math.min(...xData) * 0.5;
            const maxX = Math.max(...xData) * 1.5;
            const curveData = [];

            for (let x = minX; x <= maxX; x += (maxX - minX) / 200) {
                let y;
                if (currentMethod === '4pl-seg') {
                    y = pl4(x, ...fittedParams);
                } else if (currentMethod === '5pl-seg') {
                    y = pl5(x, ...fittedParams);
                }
                curveData.push({ x, y });
            }

            return curveData;
        }

        // Ø±Ø³Ù… Ù†Ù…ÙˆØ¯Ø§Ø±
        function drawChart(curveData) {
            const ctx = document.getElementById('myChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Ù†Ù‚Ø§Ø· ÙˆØ§Ù‚Ø¹ÛŒ',
                            data: dataPoints,
                            backgroundColor: 'rgba(255, 99, 132, 0.8)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            pointRadius: 8,
                            pointHoverRadius: 10
                        },
                        {
                            label: 'Ù…Ù†Ø­Ù†ÛŒ Ø¨Ø±Ø§Ø²Ø´ Ø´Ø¯Ù‡',
                            data: curveData,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            showLine: true,
                            pointRadius: 0,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2,
                    plugins: {
                        title: {
                            display: true,
                            text: 'JooyaCal Pro - Ù…Ù†Ø­Ù†ÛŒ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§Ø³ÛŒÙˆÙ†',
                            font: { size: 18 }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ØºÙ„Ø¸Øª (Concentration)',
                                font: { size: 14 }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Ø³ÛŒÚ¯Ù†Ø§Ù„ (Signal)',
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });

            document.getElementById('chart-container').style.display = 'block';
        }

        // ========== Ù…Ø­Ø§Ø³Ø¨Ù‡ ØºÙ„Ø¸Øª ==========
        
        function calculateConcentration(signal) {
            // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ù†Ø­Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯
            const useAdjusted = isAdjusted && adjustedParams;
            
            if (currentMethod === 'point') {
                const xData = dataPoints.map(p => p.x);
                const yData = dataPoints.map(p => p.y);

                for (let i = 0; i < yData.length - 1; i++) {
                    if ((signal >= yData[i] && signal <= yData[i + 1]) ||
                        (signal <= yData[i] && signal >= yData[i + 1])) {
                        const t = (signal - yData[i]) / (yData[i + 1] - yData[i]);
                        return xData[i] + t * (xData[i + 1] - xData[i]);
                    }
                }

            } else if (currentMethod === 'cubic') {
                if (!splineCoefficients) return null;
                
                // Ø­Ù„ Ø¹Ø¯Ø¯ÛŒ Ù…Ø¹Ú©ÙˆØ³ spline
                return solveSplineInverse(signal, splineCoefficients);

            } else if (currentMethod === '4pl' || currentMethod === '4pl-seg') {
                const params = useAdjusted ? adjustedParams : fittedParams;
                if (!params) return null;
                return solvePL(signal, params, pl4);

            } else if (currentMethod === '5pl' || currentMethod === '5pl-seg') {
                const params = useAdjusted ? adjustedParams : fittedParams;
                if (!params) return null;
                return solvePL(signal, params, pl5);
            }

            return null;
        }

        function solveSplineInverse(targetY, spline) {
            const xData = dataPoints.map(p => p.x);
            let left = Math.min(...xData) * 0.1;
            let right = Math.max(...xData) * 10;

            const tolerance = 1e-8;
            const maxIter = 100;

            for (let i = 0; i < maxIter; i++) {
                const mid = (left + right) / 2;
                const yMid = evaluateSpline(mid, spline);

                if (Math.abs(yMid - targetY) < tolerance) {
                    return mid;
                }

                const yLeft = evaluateSpline(left, spline);
                if ((yLeft - targetY) * (yMid - targetY) < 0) {
                    right = mid;
                } else {
                    left = mid;
                }

                if (Math.abs(right - left) < tolerance) {
                    return (left + right) / 2;
                }
            }

            return (left + right) / 2;
        }

        // Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ØªÚ© Ù†Ù…ÙˆÙ†Ù‡
        function predictSingle() {
            const signal = parseFloat(document.getElementById('new-signal').value);
            
            if (isNaN(signal)) {
                alert('âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            const concentration = calculateConcentration(signal);

            const resultDiv = document.getElementById('predict-result');
            if (concentration !== null) {
                let curveType = 'Ø§ÙˆÙ„ÛŒÙ‡';
                if (isAdjusted && adjustedParams) {
                    curveType = 'ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ (Adjusted)';
                }
                
                resultDiv.innerHTML = `
                    <div class="results" style="margin-top: 20px;">
                        <h3>âœ… Ù†ØªÛŒØ¬Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡</h3>
                        <div class="result-item">Ù…Ù†Ø­Ù†ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡: <strong>${curveType}</strong></div>
                        <div class="result-item" style="font-size: 1.2em; background: #d4edda; color: #155724;">
                            Ø³ÛŒÚ¯Ù†Ø§Ù„: <strong>${signal.toFixed(6)}</strong> â† ØºÙ„Ø¸Øª: <strong>${concentration.toFixed(6)}</strong>
                        </div>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="results" style="margin-top: 20px; background: #f8d7da; border-color: #dc3545;">
                        <h3>âŒ Ø®Ø·Ø§</h3>
                        <div class="result-item">Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø§Ø³Øª!</div>
                    </div>
                `;
            }
        }

        // Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ
        function predictBatch() {
            const input = document.getElementById('batch-signals').value.trim();
            
            if (!input) {
                alert('âš ï¸ Ù„Ø·ÙØ§Ù‹ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            let signals = input
                .split(/[\n,\s]+/)
                .map(s => parseFloat(s.trim()))
                .filter(s => !isNaN(s));

            if (signals.length === 0) {
                alert('âš ï¸ Ù‡ÛŒÚ† Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!');
                return;
            }

            const results = signals.map((signal, index) => {
                const concentration = calculateConcentration(signal);
                return {
                    index: index + 1,
                    signal: signal,
                    concentration: concentration,
                    valid: concentration !== null
                };
            });

            displayBatchResults(results);
        }

        function displayBatchResults(results) {
            const validResults = results.filter(r => r.valid);
            const invalidResults = results.filter(r => !r.valid);

            let curveType = 'Ø§ÙˆÙ„ÛŒÙ‡';
            if (isAdjusted && adjustedParams) {
                curveType = 'ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ (Adjusted)';
            }

            let html = '<div class="results" style="margin-top: 20px;">';
            html += '<h3>ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ</h3>';
            html += `<p style="margin-bottom: 10px;"><strong>Ù…Ù†Ø­Ù†ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡:</strong> ${curveType}</p>`;
            html += `<p style="margin-bottom: 15px;">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„: ${results.length} | Ù…ÙˆÙÙ‚: ${validResults.length} | Ù†Ø§Ù…ÙˆÙÙ‚: ${invalidResults.length}</p>`;

            html += '<table class="batch-results-table">';
            html += '<thead><tr>';
            html += '<th style="width: 80px;">Ø±Ø¯ÛŒÙ</th>';
            html += '<th>Ø³ÛŒÚ¯Ù†Ø§Ù„ (Signal)</th>';
            html += '<th>ØºÙ„Ø¸Øª (Concentration)</th>';
            html += '<th>ÙˆØ¶Ø¹ÛŒØª</th>';
            html += '</tr></thead>';
            html += '<tbody>';

            results.forEach(result => {
                const rowClass = result.valid ? 'highlight-row' : 'error-row';
                html += `<tr class="${rowClass}">`;
                html += `<td>${result.index}</td>`;
                html += `<td>${result.signal.toFixed(6)}</td>`;
                html += `<td>${result.valid ? result.concentration.toFixed(6) : '---'}</td>`;
                html += `<td>${result.valid ? 'âœ… Ù…ÙˆÙÙ‚' : 'âŒ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡'}</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';

            html += '<div class="export-buttons">';
            html += '<button class="btn btn-info" onclick="exportToCSV()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ CSV</button>';
            html += '<button class="btn btn-info" onclick="exportToText()">ğŸ“„ Ø¯Ø§Ù†Ù„ÙˆØ¯ TXT</button>';
            html += '<button class="btn btn-secondary" onclick="copyToClipboard()">ğŸ“‹ Ú©Ù¾ÛŒ Ø¨Ù‡ Ú©Ù„ÛŒÙ¾Ø¨ÙˆØ±Ø¯</button>';
            html += '</div>';

            html += '</div>';

            document.getElementById('batch-result').innerHTML = html;

            window.batchResults = results;
        }

        // Export functions
        function exportToCSV() {
            if (!window.batchResults) return;

            let csv = '\ufeffØ±Ø¯ÛŒÙ,Ø³ÛŒÚ¯Ù†Ø§Ù„,ØºÙ„Ø¸Øª,ÙˆØ¶Ø¹ÛŒØª\n';
            csv += '# JooyaCal Pro - Developed by Dr. Jooya\n';
            window.batchResults.forEach(r => {
                csv += `${r.index},${r.signal.toFixed(6)},${r.valid ? r.concentration.toFixed(6) : 'N/A'},${r.valid ? 'Ù…ÙˆÙÙ‚' : 'Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡'}\n`;
            });

            downloadFile(csv, 'jooyacal_results.csv', 'text/csv');
        }

        function exportToText() {
            if (!window.batchResults) return;

            let txt = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
            txt += '   JooyaCal Pro v2.0\n';
            txt += '   Developed by Dr. Jooya\n';
            txt += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            txt += 'Ù†ØªØ§ÛŒØ¬ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù…Ù†Ø­Ù†ÛŒ Ú©Ø§Ù„ÛŒØ¨Ø±Ø§Ø³ÛŒÙˆÙ†\n';
            txt += '-------------------------------------\n\n';
            
            window.batchResults.forEach(r => {
                txt += `Ø±Ø¯ÛŒÙ ${r.index}:\n`;
                txt += `  Ø³ÛŒÚ¯Ù†Ø§Ù„: ${r.signal.toFixed(6)}\n`;
                txt += `  ØºÙ„Ø¸Øª: ${r.valid ? r.concentration.toFixed(6) : 'Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡'}\n`;
                txt += `  ÙˆØ¶Ø¹ÛŒØª: ${r.valid ? 'âœ… Ù…ÙˆÙÙ‚' : 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚'}\n\n`;
            });

            txt += '\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
            txt += 'Â© 2025 Dr. Jooya - All Rights Reserved\n';
            txt += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';

            downloadFile(txt, 'jooyacal_results.txt', 'text/plain');
        }

        function copyToClipboard() {
            if (!window.batchResults) return;

            let text = 'JooyaCal Pro by Dr. Jooya\n';
            text += 'Ø±Ø¯ÛŒÙ\tØ³ÛŒÚ¯Ù†Ø§Ù„\tØºÙ„Ø¸Øª\tÙˆØ¶Ø¹ÛŒØª\n';
            window.batchResults.forEach(r => {
                text += `${r.index}\t${r.signal.toFixed(6)}\t${r.valid ? r.concentration.toFixed(6) : 'N/A'}\t${r.valid ? 'Ù…ÙˆÙÙ‚' : 'Ù†Ø§Ù…ÙˆÙÙ‚'}\n`;
            });

            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… Ù†ØªØ§ÛŒØ¬ Ø¨Ù‡ Ú©Ù„ÛŒÙ¾Ø¨ÙˆØ±Ø¯ Ú©Ù¾ÛŒ Ø´Ø¯!');
            }).catch(() => {
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†!');
            });
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type + ';charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            URL.revokeObjectURL(link.href);
        }

        // Ø­Ù„ Ø¹Ø¯Ø¯ÛŒ Ù…Ø¹Ø§Ø¯Ù„Ù‡
        function solvePL(targetY, params, func) {
            const xData = dataPoints.map(p => p.x);
            let left = Math.min(...xData) * 0.1;
            let right = Math.max(...xData) * 10;

            const tolerance = 1e-8;
            const maxIter = 100;

            for (let i = 0; i < maxIter; i++) {
                const mid = (left + right) / 2;
                const yMid = func(mid, ...params);

                if (Math.abs(yMid - targetY) < tolerance) {
                    return mid;
                }

                const yLeft = func(left, ...params);
                if ((yLeft - targetY) * (yMid - targetY) < 0) {
                    right = mid;
                } else {
                    left = mid;
                }

                if (Math.abs(right - left) < tolerance) {
                    return (left + right) / 2;
                }
            }

            return (left + right) / 2;
        }

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ú†ÛŒØ²
        function clearAll() {
            document.getElementById('data-inputs').innerHTML = '';
            for (let i = 0; i < 4; i++) {
                addDataPoint();
            }
            
            if (chart) {
                chart.destroy();
                chart = null;
            }
            
            document.getElementById('chart-container').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            document.getElementById('predict-section').style.display = 'none';
            document.getElementById('adjustment-section').style.display = 'none';
            document.getElementById('adjusted-results').style.display = 'none';
            
            document.getElementById('new-signal').value = '';
            document.getElementById('batch-signals').value = '';
            document.getElementById('predict-result').innerHTML = '';
            document.getElementById('batch-result').innerHTML = '';
            
            document.getElementById('cal1-conc').value = '';
            document.getElementById('cal1-signal').value = '';
            document.getElementById('cal1-predicted').value = '';
            document.getElementById('cal2-conc').value = '';
            document.getElementById('cal2-signal').value = '';
            document.getElementById('cal2-predicted').value = '';
            
            dataPoints = [];
            fittedParams = null;
            adjustedParams = null;
            splineCoefficients = null;
            window.batchResults = null;
            isAdjusted = false;
        }

        // Ø«Ø¨Øª Service Worker Ø¨Ø±Ø§ÛŒ PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {});
        }
    </script>
</body>
</html>
